# ============================================================================
# üéµ SONG-NEXUS BACKEND ENVIRONMENT CONFIGURATION
# ============================================================================
# Copy this file to .env and fill in with your actual values
# This is the SOURCE OF TRUTH for all backend environment variables

# ============================================================================
# üåç ENVIRONMENT & SERVER
# ============================================================================
NODE_ENV=development
HOST=localhost
PORT=3000
TRUST_PROXY=false

# ============================================================================
# üóÑÔ∏è  DATABASE CONFIGURATION
# ============================================================================
# PostgreSQL connection details
DB_HOST=localhost
DB_PORT=5432
DB_NAME=song_nexus_dev
DB_USER=postgres
DB_PASSWORD=your-db-password-here
DB_SSL=false

# Database Connection Pool
DB_POOL_MIN=2
DB_POOL_MAX=20
DB_IDLE_TIMEOUT_MS=30000
DB_CONNECTION_TIMEOUT_MS=10000

# ============================================================================
# üîê AUTHENTICATION & SECURITY
# ============================================================================
# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-min-32-chars-change-in-production
JWT_EXPIRE=7d
JWT_REFRESH_SECRET=your-refresh-secret-min-32-chars-change-in-production

# Session Configuration
SESSION_SECRET=your-session-secret-min-32-chars-change-in-production
SESSION_MAX_AGE=900000
COOKIE_SECRET=your-cookie-secret-min-32-chars-change-in-production

# Password Hashing
BCRYPT_ROUNDS=10

# CSRF Protection
CSRF_TOKEN_LENGTH=32

# ============================================================================
# üîê WEBAUTHN BIOMETRIC AUTHENTICATION
# ============================================================================
# Relying Party (RP) Configuration - must match frontend origin exactly!
WEBAUTHN_RP_ID=localhost
WEBAUTHN_RP_NAME=SONG-NEXUS
WEBAUTHN_ORIGIN=https://localhost:5500
WEBAUTHN_TIMEOUT=60000

# Supported Algorithms
WEBAUTHN_ALGORITHMS=ES256,RS256

# ============================================================================
# üîí HTTPS & SSL/TLS CERTIFICATES
# ============================================================================
# For development: use mkcert-generated certificates
# For production: use Let's Encrypt or other CA-signed certificates

USE_HTTPS=true
CERT_PATH=./backend/certs/localhost.pem
KEY_PATH=./backend/certs/localhost-key.pem

# HSTS Configuration
HSTS_MAX_AGE=31536000
HSTS_INCLUDE_SUBDOMAINS=true
HSTS_PRELOAD=true

# ============================================================================
# üåê CORS & FRONTEND CONFIGURATION
# ============================================================================
# Frontend URL(s) allowed to access this backend
FRONTEND_URL=https://localhost:5500
ALLOWED_ORIGINS=https://localhost:5500,http://localhost:5500,http://127.0.0.1:5500,https://127.0.0.1:5500
API_BASE=https://localhost:3000/api

# For ngrok tunneling (development with mobile/remote testing)
# ALLOWED_ORIGINS=https://your-ngrok-domain.ngrok-free.dev

# ============================================================================
# üí≥ PAYPAL INTEGRATION
# ============================================================================
PAYPAL_MODE=sandbox
PAYPAL_CLIENT_ID=your-paypal-sandbox-client-id
PAYPAL_CLIENT_SECRET=your-paypal-sandbox-secret
PAYPAL_WEBHOOK_ID=your-paypal-webhook-id

# Production Mode (when ready)
# PAYPAL_MODE=live
# PAYPAL_CLIENT_ID=your-paypal-live-client-id
# PAYPAL_CLIENT_SECRET=your-paypal-live-secret

# ============================================================================
# üì§ FILE UPLOAD CONFIGURATION
# ============================================================================
UPLOAD_DIR=./backend/public/audio
MAX_FILE_SIZE=104857600
ALLOWED_AUDIO_FORMATS=mp3,wav,m4a,flac
ALLOWED_IMAGE_FORMATS=jpg,jpeg,png,webp,gif

# ============================================================================
# üõ°Ô∏è  RATE LIMITING & SECURITY
# ============================================================================
# Auth endpoints (login, register, etc.)
RATE_LIMIT_AUTH_WINDOW_MS=900000
RATE_LIMIT_AUTH_MAX=5

# General API endpoints
RATE_LIMIT_API_WINDOW_MS=60000
RATE_LIMIT_API_MAX=30

# Audio streaming endpoints
RATE_LIMIT_STREAM_WINDOW_MS=60000
RATE_LIMIT_STREAM_MAX=50

# WebAuthn endpoints
RATE_LIMIT_WEBAUTHN_WINDOW_MS=900000
RATE_LIMIT_WEBAUTHN_MAX=20

# ============================================================================
# üìä LOGGING & MONITORING
# ============================================================================
LOG_LEVEL=info
LOG_FILE=logs/app.log
LOG_FORMAT=combined
LOG_MAX_SIZE=10M
LOG_MAX_FILES=5
LOG_COMPRESSION=gzip

# Performance Monitoring
ENABLE_PERFORMANCE_MONITOR=true
PERFORMANCE_LOG_FILE=logs/performance.log

# ============================================================================
# ‚è±Ô∏è  FEATURE FLAGS & TIMEOUTS
# ============================================================================
# Magic Link Email Auth
MAGIC_LINK_ENABLED=true
MAGIC_LINK_EXPIRY_MINUTES=15
MAGIC_LINK_TOKEN_LENGTH=32

# Email Configuration (if implementing email features)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@example.com
SMTP_PASSWORD=your-app-specific-password
SMTP_FROM=noreply@songnexus.app

# Database Soft-Delete
SOFT_DELETE_ENABLED=true

# Development Features
DEV_LOGIN_ENABLED=false
DEV_CORS_PERMISSIVE=false

# ============================================================================
# üé® DESIGN SYSTEM CONFIGURATION
# ============================================================================
# Design system is stored in database (design_system table)
# These are defaults used if database is empty
DEFAULT_DESIGN_THEME=light
DEFAULT_PRIMARY_COLOR=#00CC77
DEFAULT_SECONDARY_COLOR=#5E5240
DEFAULT_BACKGROUND_COLOR=#FCF8F9
DEFAULT_TEXT_COLOR=#00ffff

# ============================================================================
# üì± ANALYTICS & TRACKING
# ============================================================================
ENABLE_PLAY_HISTORY=true
ENABLE_USER_STATISTICS=true
ENABLE_LEADERBOARDS=true

# Error Tracking (Sentry, LogRocket, etc.)
SENTRY_DSN=
SENTRY_ENVIRONMENT=development
SENTRY_TRACE_SAMPLE_RATE=1.0

# ============================================================================
# üìû EXTERNAL SERVICES
# ============================================================================
# Email Service (SendGrid, Mailgun, etc.)
SENDGRID_API_KEY=
MAILGUN_API_KEY=
MAILGUN_DOMAIN=

# CDN Configuration (for static assets)
CDN_URL=
CDN_BUCKET=
CDN_REGION=

# ============================================================================
# üöÄ DEPLOYMENT-SPECIFIC SETTINGS
# ============================================================================
# Docker Container Environment
DOCKER_BUILD=false
DOCKER_PORT=3000

# Kubernetes / Cloud Platform
CLUSTER_NAME=
NAMESPACE=default

# ============================================================================
# üìù NOTES FOR PRODUCTION DEPLOYMENT
# ============================================================================
# 1. Change all SECRET values (JWT_SECRET, SESSION_SECRET, etc.)
#    Use: openssl rand -base64 32
# 2. Use strong database password
# 3. Set NODE_ENV=production
# 4. Update WebAuthn RP settings to match your domain
# 5. Configure real PayPal live credentials
# 6. Use SSL certificates from Let's Encrypt (not mkcert)
# 7. Set TRUST_PROXY=true if behind reverse proxy (Nginx, Cloudflare)
# 8. Monitor logs regularly for security issues
# 9. Setup database backups and replication
# 10. Consider using environment-specific .env files:
#     - .env.development (for development)
#     - .env.staging (for staging/testing)
#     - .env.production (for production)
