<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="ğŸµ SONG-NEXUS â€“ Kostenlose, werbefreie Musikstreaming-Plattform. Keine Cookies, kein Tracking, reine Audio-QualitÃ¤t.">
    <meta name="keywords" content="musik streaming, kostenlos, keine werbung, datenschutz, open source">
    <meta name="theme-color" content="#0a0e1a">
    <meta name="color-scheme" content="dark light">

    <!-- Open Graph (Social Sharing) -->
    <meta property="og:title" content="ğŸµ SONG-NEXUS â€“ Kostenlose Musikstreaming">
    <meta property="og:description"
        content="HÃ¶re Musik frei, ohne Werbung, ohne Cookies, ohne Tracking. Barrierefreie Streaming-Plattform.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://song-nexus.com">
    <meta property="og:image"
        content="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect fill='%230a0e1a' width='200' height='200'/><text x='50%' y='50%' font-size='100' fill='%2300ff00' text-anchor='middle' dy='.3em'>â™ª</text></svg>">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ğŸµ SONG-NEXUS â€“ Musikstreaming">
    <meta name="twitter:description" content="Musik frei hÃ¶ren, ohne Werbung, ohne Tracking.">

    <!-- Canonical URL (fÃ¼r SEO) -->
    <link rel="canonical" href="https://song-nexus.com">

    <!-- Performance: Preconnect zu Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Performance: DNS Prefetch fÃ¼r API -->
    <link rel="dns-prefetch" href="https://api.paypal.com">

    <!-- âœ… Performance: Preload optimierte Bilder (WebP + JPEG) -->
    <link rel="preload" as="image" href="./assets/images/Hintergrundbild 1.webp" type="image/webp">
    <link rel="preload" as="image" href="./assets/images/Hintergrundbild 1.jpeg" type="image/jpeg">

    <title>ğŸµ SONG-NEXUS â€“ Musikstreaming-Plattform</title>

    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75' fill='%2300ff00'>â™ª</text></svg>">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Orbitron:wght@700;900&display=swap"
        rel="stylesheet">

    <!-- âœ… CSS - KORREKT VERLINKT (Relative Pfade) -->
    <link rel="stylesheet" href="./styles/index.css">

    <!-- ğŸ¨ DESIGN-SYSTEM STYLES (wird dynamisch geladen) -->
    <style id="design-system-styles">
        /* Design-System Farben & Bilder werden hier injiziert */
    </style>
</head>

<body>
    <!-- âœ… OPTIMIERTES HERO-HINTERGRUNDBILD MIT PICTURE ELEMENT -->
    <div id="heroBackground" class="hero-background-container" role="img" aria-label="Cyberpunk Musik Hintergrund">
        <picture>
            <source srcset="./assets/images/Hintergrundbild 1.webp" type="image/webp">
            <source srcset="./assets/images/Hintergrundbild 1.jpeg" type="image/jpeg">
            <img src="./assets/images/Hintergrundbild 1.jpeg"
                alt="Cyberpunk Stadt Hintergrund - Neon und Stadt-Szenerie" class="hero-background-image" loading="lazy"
                decoding="async">
        </picture>
    </div>

    <!-- ========================================================================
         ğŸµ STICKY PLAYER (Always visible bottom-right)
         ======================================================================== -->
    <div id="stickyPlayer" class="sticky-player" data-draggable role="region" aria-label="Audio-Player">
        <div class="player-header" id="playerHeader">
            <div class="now-playing">
                <div class="track-name">Bereit zum Abspielen...</div>
                <div class="track-artist">WÃ¤hlen Sie einen Track</div>
            </div>
            <div class="player-btn-group">
                <button id="playerMinimize" class="player-btn" aria-label="Player minimieren"
                    title="Minimieren">âˆ’</button>
                <button id="playerClose" class="player-btn" aria-label="Player schlieÃŸen" title="SchlieÃŸen">âœ•</button>
            </div>
        </div>

        <div id="playerContent" class="player-content">
            <!-- Waveform Visualizer -->
            <canvas id="playerWaveform" class="waveform" aria-hidden="true" width="300" height="60"></canvas>

            <!-- Time Display -->
            <div class="time-display">
                <span id="playerCurrentTime" aria-live="polite">0:00</span>
                <div id="playerSeekBar" class="seek-bar" role="slider" aria-label="Track-Position" aria-valuemin="0"
                    aria-valuemax="100" aria-valuenow="0" tabindex="0">
                </div>
                <span id="playerDuration" aria-label="Gesamtdauer">0:00</span>
            </div>

            <!-- Preview Badge -->
            <div id="previewBadge" class="preview-badge" style="display: none;" role="alert">
                ğŸ“¢ 40s VORSCHAU â€¢ Kaufen zum Freischalten
            </div>

            <!-- Controls -->
            <div class="player-controls">
                <button id="playerPlayBtn" class="btn-control" aria-label="Abspielen" title="Abspielen">â–¶ï¸</button>
                <button id="playerPauseBtn" class="btn-control" style="display: none;" aria-label="Pausieren"
                    title="Pausieren">â¸ï¸</button>
                <button id="playerStopBtn" class="btn-control" aria-label="Stoppen" title="Stoppen">â¹ï¸</button>
                <button id="playerLoopBtn" class="btn-control" aria-label="Schleife" title="Schleife">ğŸ”„</button>
                <button id="playerMuteBtn" class="btn-control" aria-label="Stummschalten"
                    title="Stummschalten">ğŸ”Š</button>
            </div>

            <!-- Volume Slider -->
            <div class="volume-control">
                <label for="playerVolumeSlider" class="volume-label">LautstÃ¤rke:</label>
                <input id="playerVolumeSlider" type="range" min="0" max="100" value="80" class="volume-slider"
                    aria-label="LautstÃ¤rkeregler" aria-valuemin="0" aria-valuemax="100">
            </div>
        </div>

        <!-- âœ… Resize Handle (unten rechts) -->
        <div class="player-resize-handle" id="playerResizeHandle" aria-label="Player vergrÃ¶ÃŸern/verkleinern"></div>
    </div>

    <!-- ========================================================================
         HEADER
         ======================================================================== -->
    <header role="banner">
        <div class="header-content">
            <div class="logo-section">
                <h1 id="neonSign">â™ª SONG-NEXUS</h1>
                <div class="neon-grime" style="
                    position: absolute;
                    top: -10px;
                    left: 0;
                    width: 100%;
                    height: 120%;
                    pointer-events: none;
                    background: radial-gradient(circle at 30% 40%, rgba(0,0,0,0.25), transparent),
                                radial-gradient(circle at 70% 60%, rgba(0,0,0,0.2), transparent),
                                radial-gradient(circle at 20% 80%, rgba(80,40,0,0.15), transparent);
                    filter: blur(8px);
                "></div>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="Dunkelmodus / Hellmodus umschalten"
                    aria-pressed="true">ğŸŒ™</button>
                <div id="userInfo" class="user-info" style="display: none;" role="complementary">
                    <span id="userDisplay">ğŸ‘¤ Benutzer</span>
                    <button class="button button-sm" id="logoutBtn" aria-label="Abmelden">Abmelden</button>
                </div>
                <button id="authButton" class="button button-sm" aria-label="Anmeldung Ã¶ffnen">Anmelden</button>
            </div>
        </div>
    </header>

    <!-- ========================================================================
         MAIN CONTENT
         ======================================================================== -->
    <main class="container" role="main">

        <!-- ====================================================================
             ğŸ¬ HERO SECTION
             ==================================================================== -->
        <section class="hero" aria-labelledby="hero-heading">
            <h2 id="hero-heading">Willkommen bei SONG-NEXUS</h2>
            <p class="hero-subtitle">
                ğŸµ Musikstreaming ohne Werbung, ohne Cookies, ohne Tracking.<br>
                <strong>Optional anmelden fÃ¼r persÃ¶nliche Funktionen.</strong>
            </p>
        </section>

        <!-- ====================================================================
             ğŸ” OPTIONAL AUTH MODAL
             ==================================================================== -->
        <div id="authModal" class="modal-overlay" style="display: none;" role="dialog"
            aria-labelledby="auth-modal-title" aria-modal="true">
            <div class="modal-content">
                <h2 id="auth-modal-title">ğŸ” Authentifizierung</h2>
                <p style="color: var(--color-text-secondary); font-size: 0.9rem;">
                    Optional: Melden Sie sich an, um Verlauf, Wiedergabelisten und Premium-Funktionen zu nutzen.
                </p>

                <!-- Tabs -->
                <div class="tabs" role="tablist">
                    <button class="tab-btn active" data-tab="webauthn" aria-selected="true" role="tab"
                        aria-controls="webauthn-tab" id="tab-webauthn">ğŸ‘† Fingerabdruck</button>
                    <button class="tab-btn" data-tab="password" aria-selected="false" role="tab"
                        aria-controls="password-tab" id="tab-password">ğŸ”‘ Passwort</button>
                    <button class="tab-btn" data-tab="magic-link" aria-selected="false" role="tab"
                        aria-controls="magic-link-tab" id="tab-magic">ğŸ“§ E-Mail</button>
                </div>

                <!-- WebAuthn Tab -->
                <div id="webauthn-tab" class="tab-content active" role="tabpanel" aria-labelledby="tab-webauthn">
                    <div style="text-align: center; padding: 20px 0;">
                        <button class="button" id="webauthnBtn" aria-label="Mit Fingerabdruck anmelden">ğŸ‘† Fingerabdruck
                            verwenden</button>
                        <p style="color: var(--color-text-secondary); margin-top: 12px; font-size: 0.85rem;">
                            Erste Anmeldung? <a href="#" id="toggleBioRegisterBtn"
                                style="color: var(--color-primary); cursor: pointer;">Mit Fingerabdruck registrieren</a>
                        </p>
                        <div id="bioRegisterModal"
                            style="display: none; margin-top: 16px; padding: 16px; border: 1px solid var(--color-primary); border-radius: 4px;">
                            <h3 style="color: var(--color-primary); margin-bottom: 12px;">ğŸ“ Registrierung</h3>
                            <input type="text" id="bioRegUsername" placeholder="Benutzername" class="form-control"
                                aria-label="Benutzername">
                            <input type="email" id="bioRegEmail" placeholder="E-Mail" class="form-control"
                                aria-label="E-Mail-Adresse">
                            <button class="button" id="registerBiometricBtn"
                                style="width: 100%; margin-top: 12px;">Registrieren</button>
                        </div>
                        <div id="bioStatus" class="status-message" role="alert" aria-live="polite"></div>
                    </div>
                </div>

                <!-- PASSWORD LOGIN/REGISTER TAB -->
                <div id="password-tab" class="tab-content" role="tabpanel" aria-labelledby="tab-password">
                    <!-- LOGIN FORM (Default) -->
                    <div id="passwordLoginForm">
                        <form id="passwordLoginFormElement" data-form="password-login" novalidate>
                            <div class="form-group">
                                <label for="loginEmail">E-Mail oder Benutzername</label>
                                <input type="text" id="loginEmail" placeholder="ihre@email.com oder benutzername"
                                    required class="form-control" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Passwort</label>
                                <input type="password" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required
                                    class="form-control" aria-required="true">
                            </div>
                            <button type="submit" class="button" style="width: 100%;">ğŸ” Anmelden</button>
                        </form>
                        <p style="color: var(--color-text-secondary); margin-top: 12px; font-size: 0.85rem;">
                            Noch kein Konto? <a href="#" id="togglePasswordRegisterBtn"
                                style="color: var(--color-primary); cursor: pointer;">Jetzt registrieren</a>
                        </p>
                        <div id="passwordStatus" class="status-message" role="alert" aria-live="polite"></div>
                    </div>

                    <!-- REGISTRATION FORM (Hidden by default) -->
                    <div id="passwordRegisterForm" style="display: none;">
                        <form id="passwordRegisterFormElement" novalidate>
                            <div class="form-group">
                                <label for="regUsername">Benutzername</label>
                                <input type="text" id="regUsername" placeholder="dein_name" required
                                    class="form-control" aria-required="true">
                                <small style="color: var(--color-text-secondary);">3-20 Zeichen, alphanumerisch</small>
                            </div>
                            <div class="form-group">
                                <label for="regEmail">E-Mail-Adresse</label>
                                <input type="email" id="regEmail" placeholder="deine@email.com" required
                                    class="form-control" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label for="regPassword">Passwort</label>
                                <input type="password" id="regPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required
                                    class="form-control" aria-required="true">
                                <small style="color: var(--color-text-secondary);">Mindestens 8 Zeichen</small>
                            </div>
                            <div class="form-group">
                                <label for="regPasswordConfirm">Passwort wiederholen</label>
                                <input type="password" id="regPasswordConfirm" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required
                                    class="form-control" aria-required="true">
                            </div>
                            <button type="submit" class="button"
                                style="width: 100%; background: var(--color-primary);">âœ…
                                Registrieren</button>
                            <button type="button" id="cancelPasswordRegisterBtn" class="button"
                                style="width: 100%; margin-top: 8px; background: var(--color-text-secondary);">âŒ
                                Abbrechen</button>
                        </form>
                        <div id="registerStatus" class="status-message" role="alert" aria-live="polite"></div>
                    </div>
                </div>

                <!-- Magic Link Tab -->
                <div id="magic-link-tab" class="tab-content" role="tabpanel" aria-labelledby="tab-magic">
                    <div class="form-group">
                        <label for="magicEmail">E-Mail-Adresse</label>
                        <input type="email" id="magicEmail" placeholder="ihre@email.com" class="form-control"
                            aria-label="E-Mail-Adresse" aria-required="true">
                    </div>
                    <button class="button" id="magicLinkBtn" style="width: 100%;">ğŸ“§ Anmeldelink senden</button>
                    <div id="magicStatus" class="status-message" role="alert" aria-live="polite"></div>

                    <!-- Manual Magic Link Verification -->
                    <div
                        style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--color-primary); opacity: 0.8;">
                        <p style="color: var(--color-text-secondary); font-size: 0.85rem; margin-bottom: 12px;">
                            ğŸ“Œ Oder gib den Token manuell ein:
                        </p>
                        <div class="form-group">
                            <label for="magicToken">Verifikations-Token</label>
                            <input type="text" id="magicToken" placeholder="Token aus der E-Mail einfÃ¼gen..."
                                class="form-control" aria-label="Magic Link Token" aria-required="false">
                        </div>
                        <button class="button" id="magicVerifyBtn"
                            style="width: 100%; background: var(--color-primary);">âœ… Token
                            verifizieren</button>
                    </div>
                    <div id="magicVerifyStatus" class="status-message" role="alert" aria-live="polite"></div>
                </div>

                <!-- Close Modal Button -->
                <button class="button button-secondary" id="closeAuthModalBtn" style="width: 100%; margin-top: 20px;"
                    aria-label="Authentifizierungsmodal schlieÃŸen">SchlieÃŸen</button>
            </div>
        </div>

        <!-- ====================================================================
             ğŸµ FEATURED TRACKS
             ==================================================================== -->
        <section class="featured-section" aria-labelledby="tracks-heading">
            <h2 id="tracks-heading">ğŸµ Beliebte Tracks</h2>
            <p class="section-subtitle">Musik, keine Anmeldung erforderlich. 40 Sekunden Vorschau fÃ¼r
                Premium-Tracks.</p>
            <div id="tracksList" class="track-grid" role="region" aria-label="Beliebte Tracks" aria-live="polite"
                aria-busy="true">
                <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px;">
                    <p style="color: var(--color-text-secondary);">â³ Tracks werden geladen...</p>
                </div>
            </div>
        </section>

        <!-- ====================================================================
             ğŸ“ BLOG PREVIEW
             ==================================================================== -->
        <section class="blog-section" aria-labelledby="blog-heading">
            <h2 id="blog-heading">ğŸ“ Neueste aus dem Blog</h2>
            <div id="blogList" class="track-grid" role="region" aria-label="Blog-BeitrÃ¤ge" aria-live="polite"
                aria-busy="true">
                <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px;">
                    <p style="color: var(--color-text-secondary);">â³ Blog-BeitrÃ¤ge werden geladen...</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <a href="blog/" class="button" aria-label="Alle Blog-BeitrÃ¤ge anzeigen">ğŸ“– Alle BeitrÃ¤ge â†’</a>
            </div>
        </section>

    </main>

    <!-- ========================================================================
         FOOTER
         ======================================================================== -->
    <footer role="contentinfo">
        <div class="footer-content">
            <div class="footer-section">
                <h3>ğŸµ SONG-NEXUS</h3>
                <p>Kostenlose, werbefreie Musikstreaming ohne Tracking.</p>
            </div>
            <div class="footer-section">
                <h3>Links</h3>
                <ul>
                    <li><a href="/" aria-label="Zur Startseite">Startseite</a></li>
                    <li><a href="blog/" aria-label="Zum Blog">Blog</a></li>
                    <li><a href="/docs/" aria-label="Zur Dokumentation">Dokumentation</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Rechtlich</h3>
                <ul>
                    <li><a href="/LICENSE" aria-label="Lizenzinformationen">Lizenz</a></li>
                    <li><a href="https://github.com/Waschtl904/song-nexus" aria-label="GitHub Repository"
                            rel="noopener noreferrer" target="_blank">GitHub</a></li>
                    <li><a href="/privacy-policy/" aria-label="DatenschutzerklÃ¤rung">Datenschutz</a></li>
                </ul>
            </div>
        </div>
        <p style="text-align: center; color: var(--color-text-secondary); font-size: 0.75rem; margin-top: 20px;">
            ğŸµ SONG-NEXUS v8.0 ES6 Modules â€¢ Gebaut mit â¤ï¸ â€¢ Â© 2025 Sebastian | â™¿ WCAG 2.2 Barrierefrei |
            <span style="color: var(--color-primary);">ğŸª Keine Cookies â€¢ ğŸ“Š Kein Tracking</span>
        </p>
    </footer>

    <!-- ========================================================================
         ğŸ¨ DESIGN-SYSTEM RUNTIME LOADER v3.0 (API + Webpack Fallback)
         ======================================================================== -->
    <script>
        /**
         * DESIGN-SYSTEM RUNTIME LOADER v3.0
         * 
         * Hybrid approach:
         * 1. Try to load from API (PostgreSQL - has latest changes from Design-Editor)
         * 2. Fallback to webpack-generated _design-tokens.css (build-time defaults)
         * 
         * This way:
         * - Design-Editor changes are reflected immediately (API)
         * - If API fails, CSS still works (Webpack fallback)
         */

        async function loadDesignSystemFromAPI() {
            try {
                console.log('ğŸ¨ Design System Runtime Loader v3.0 starting...');

                // âœ… CRITICAL: Use absolute URL to backend API
                const apiUrl = 'https://localhost:3000/api/design-system';
                console.log('ğŸŒ Attempting to load from API:', apiUrl);

                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include',
                    timeout: 5000
                });

                console.log('ğŸ“Š API Response Status:', response.status);

                if (!response.ok) {
                    console.log(`âš ï¸ API returned ${response.status}`);
                    console.log('ğŸ’¾ Using webpack-generated _design-tokens.css instead');
                    return false; // Fallback to webpack CSS
                }

                // âœ… Parse the API response
                const designSystem = await response.json();
                console.log('âœ… Design System loaded from API:', designSystem);

                // âœ… Extract nested structures CORRECTLY
                const colors = designSystem.colors || {};
                const typography = designSystem.typography || {};
                const spacing = designSystem.spacing || {};
                const radius = designSystem.radius || {};
                const components = designSystem.components || {};

                console.log('   âœ… Colors:', colors);
                console.log('   âœ… Typography:', typography);
                console.log('   âœ… Spacing:', spacing);
                console.log('   âœ… Radius:', radius);

                // âœ… Generate CSS Variables (matching webpack loader output format)
                let cssVariables = 'html {\n';

                // âœ… COLORS (aus colors-Objekt!)
                cssVariables += '  /* Colors from PostgreSQL API */\n';
                if (colors.primary) cssVariables += `  --color-primary: ${colors.primary};\n`;
                if (colors.secondary) cssVariables += `  --color-secondary: ${colors.secondary};\n`;
                if (colors.accent_teal) cssVariables += `  --color-accent-teal: ${colors.accent_teal};\n`;
                if (colors.accent_green) cssVariables += `  --color-accent-green: ${colors.accent_green};\n`;
                if (colors.accent_red) cssVariables += `  --color-accent-red: ${colors.accent_red};\n`;
                if (colors.text_primary) cssVariables += `  --color-text-primary: ${colors.text_primary};\n`;
                if (colors.background) cssVariables += `  --color-background: ${colors.background};\n`;

                // âœ… TYPOGRAPHY (aus typography-Objekt!)
                cssVariables += '  /* Typography from PostgreSQL API */\n';
                if (typography.font_family_base) {
                    cssVariables += `  --font-family-base: ${typography.font_family_base};\n`;
                }
                if (typography.font_sizes?.base) {
                    cssVariables += `  --font-size-base: ${typography.font_sizes.base};\n`;
                }
                if (typography.font_weights?.normal) {
                    cssVariables += `  --font-weight-normal: ${typography.font_weights.normal};\n`;
                }
                if (typography.font_weights?.bold) {
                    cssVariables += `  --font-weight-bold: ${typography.font_weights.bold};\n`;
                }

                // âœ… LAYOUT (aus spacing/radius-Objekten!)
                cssVariables += '  /* Layout from PostgreSQL API */\n';
                if (spacing['8']) {
                    cssVariables += `  --space-8: ${spacing['8']};\n`;
                }
                if (radius.base) {
                    cssVariables += `  --radius-base: ${radius.base};\n`;
                }

                // âœ… BUTTONS (aus components!)
                cssVariables += '  /* Buttons from PostgreSQL API */\n';
                if (components.buttons?.primary?.background) {
                    cssVariables += `  --button-primary-background: ${components.buttons.primary.background};\n`;
                }
                if (components.buttons?.primary?.padding) {
                    cssVariables += `  --button-primary-padding: ${components.buttons.primary.padding};\n`;
                }
                if (components.buttons?.primary?.border_radius) {
                    cssVariables += `  --button-primary-border-radius: ${components.buttons.primary.border_radius};\n`;
                }

                cssVariables += '}\n';

                // âœ… Inject into <style> tag (OVERWRITES webpack defaults)
                const styleElement = document.getElementById('design-system-styles');
                if (styleElement) {
                    styleElement.textContent = cssVariables;
                    console.log('âœ… Design System CSS injected from API');
                    console.log('   Primary Color:', colors.primary);
                    console.log('   Secondary Color:', colors.secondary);
                    return true;
                } else {
                    console.error('âŒ design-system-styles element not found!');
                    return false;
                }

            } catch (err) {
                console.error('âŒ Design System API Error:', err.message);
                console.log('ğŸ’¾ Falling back to webpack-generated _design-tokens.css');
                return false;
            }
        }

        // ============================================================================
        // EXECUTE LOADER
        // ============================================================================

        console.log('');
        console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');
        console.log('â•‘  ğŸ¨ DESIGN-SYSTEM LOADER ACTIVE            â•‘');
        console.log('â•‘  Trying API â†’ Fallback to Webpack CSS     â•‘');
        console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
        console.log('');

        // Load immediately if DOM is ready, otherwise wait
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', async () => {
                const success = await loadDesignSystemFromAPI();
                if (!success) {
                    console.log('ğŸ’¾ Using webpack-generated CSS from _design-tokens.css');
                }
            });
        } else {
            // DOM already loaded
            loadDesignSystemFromAPI().then(success => {
                if (!success) {
                    console.log('ğŸ’¾ Using webpack-generated CSS from _design-tokens.css');
                }
            });
        }
    </script>


    <!-- ========================================================================
         âœ… WEBPACK BUNDLE (All modules: Auth, WebAuthn, Player, Tracks, etc.)
         ======================================================================== -->
    <script src="./dist/app.bundle.js"></script>

    <!-- ========================================================================
         ğŸ”§ CRITICAL FIX: Ensure Auth module is fully initialized
         ======================================================================== -->
    <script>
        console.log('ğŸ”§ HTML Script: Ensuring Auth system is fully initialized...');

        function ensureAuthInitialized() {
            // Check if Auth module exists (from bundle)
            if (typeof Auth === 'undefined') {
                console.warn('âš ï¸ Auth module not yet available, retrying in 50ms...');
                setTimeout(ensureAuthInitialized, 50);
                return;
            }

            console.log('âœ… Auth module found in window object');

            // Call Auth.init() to attach event listeners
            if (typeof Auth.init === 'function') {
                console.log('ğŸ“‹ Calling Auth.init()...');
                Auth.init();
                console.log('âœ… Auth.init() completed');
            } else {
                console.error('âŒ Auth.init is not a function');
            }

            // Also setup close button for modal
            const closeBtn = document.getElementById('closeAuthModalBtn');
            const authModal = document.getElementById('authModal');
            if (closeBtn && authModal) {
                closeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    authModal.style.display = 'none';
                    console.log('âœ… Modal closed via close button');
                });
            }
        }

        // Trigger initialization after DOM is ready and bundle has loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(ensureAuthInitialized, 1000);
            });
        } else {
            // DOM already loaded
            setTimeout(ensureAuthInitialized, 1000);
        }
    </script>

    <!-- ========================================================================
         âœ… MAGIC LINK HANDLER
         ======================================================================== -->
    <script>
        console.log('ğŸ” Checking current URL for Magic Link:', window.location.pathname);

        if (window.location.pathname === '/auth/magic-link' ||
            window.location.pathname.includes('auth/magic-link')) {

            console.log('ğŸ”ğŸ”ğŸ” MAGIC LINK PAGE DETECTED! ğŸ”ğŸ”ğŸ”');

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', async () => {
                    console.log('ğŸ” DOM loaded, calling Auth.verifyMagicLinkFromUrl()...');
                    if (typeof Auth !== 'undefined' && Auth.verifyMagicLinkFromUrl) {
                        try {
                            const result = await Auth.verifyMagicLinkFromUrl();
                            console.log('âœ… Magic link result:', result);
                        } catch (err) {
                            console.error('âŒ Magic link verification failed:', err);
                        }
                    } else {
                        console.error('âŒ Auth module not loaded yet!');
                    }
                });
            } else {
                setTimeout(async () => {
                    console.log('ğŸ” DOM already loaded, calling Auth.verifyMagicLinkFromUrl()...');
                    if (typeof Auth !== 'undefined' && Auth.verifyMagicLinkFromUrl) {
                        try {
                            const result = await Auth.verifyMagicLinkFromUrl();
                            console.log('âœ… Magic link result:', result);
                        } catch (err) {
                            console.error('âŒ Magic link verification failed:', err);
                        }
                    }
                }, 500);
            }
        }
    </script>

</body>

</html>