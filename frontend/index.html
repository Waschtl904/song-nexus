<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="üéµ SONG-NEXUS ‚Äì Kostenlose, werbefreie Musikstreaming-Plattform. Keine Cookies, kein Tracking, reine Audio-Qualit√§t.">
    <meta name="keywords" content="musik streaming, kostenlos, keine werbung, datenschutz, open source">
    <meta name="theme-color" content="#0a0e1a">
    <meta name="color-scheme" content="dark light">

    <!-- Open Graph (Social Sharing) -->
    <meta property="og:title" content="üéµ SONG-NEXUS ‚Äì Kostenlose Musikstreaming">
    <meta property="og:description"
        content="H√∂re Musik frei, ohne Werbung, ohne Cookies, ohne Tracking. Barrierefreie Streaming-Plattform.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://song-nexus.com">
    <meta property="og:image"
        content="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'><rect fill='%230a0e1a' width='200' height='200'/><text x='50%' y='50%' font-size='100' fill='%2300ff00' text-anchor='middle' dy='.3em'>‚ô™</text></svg>">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="üéµ SONG-NEXUS ‚Äì Musikstreaming">
    <meta name="twitter:description" content="Musik frei h√∂ren, ohne Werbung, ohne Tracking.">

    <!-- Canonical URL (f√ºr SEO) -->
    <link rel="canonical" href="https://song-nexus.com">

    <!-- Performance: Preconnect zu Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Performance: DNS Prefetch f√ºr API -->
    <link rel="dns-prefetch" href="https://api.paypal.com">

    <!-- ‚úÖ Performance: Preload optimierte Bilder (WebP + JPEG) -->
    <link rel="preload" as="image" href="./assets/images/Hintergrundbild 1.webp" type="image/webp">
    <link rel="preload" as="image" href="./assets/images/Hintergrundbild 1.jpeg" type="image/jpeg">

    <title>üéµ SONG-NEXUS ‚Äì Musikstreaming-Plattform</title>

    <link rel="icon" type="image/svg+xml"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75' fill='%2300ff00'>‚ô™</text></svg>">

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Orbitron:wght@700;900&display=swap"
        rel="stylesheet">

    <!-- ‚úÖ CSS - KORREKT VERLINKT (Relative Pfade) -->
    <link rel="stylesheet" href="./styles/index.css">

    <!-- üé® DESIGN-SYSTEM STYLES (wird dynamisch geladen) -->
    <style id="design-system-styles">
        /* Design-System Farben & Bilder werden hier injiziert */
    </style>
</head>

<body>
    <!-- ‚úÖ OPTIMIERTES HERO-HINTERGRUNDBILD MIT PICTURE ELEMENT -->
    <div id="heroBackground" class="hero-background-container" role="img" aria-label="Cyberpunk Musik Hintergrund">
        <picture>
            <source srcset="./assets/images/Hintergrundbild 1.webp" type="image/webp">
            <source srcset="./assets/images/Hintergrundbild 1.jpeg" type="image/jpeg">
            <img src="./assets/images/Hintergrundbild 1.jpeg"
                alt="Cyberpunk Stadt Hintergrund - Neon und Stadt-Szenerie" class="hero-background-image" loading="lazy"
                decoding="async">
        </picture>
    </div>

    <!-- ========================================================================
         üéµ STICKY PLAYER (Always visible bottom-right)
         ======================================================================== -->
    <div id="stickyPlayer" class="sticky-player" data-draggable role="region" aria-label="Audio-Player">
        <div class="player-header" id="playerHeader">
            <div class="now-playing">
                <div class="track-name">Bereit zum Abspielen...</div>
                <div class="track-artist">W√§hlen Sie einen Track</div>
            </div>
            <div class="player-btn-group">
                <button id="playerMinimize" class="player-btn" aria-label="Player minimieren"
                    title="Minimieren">‚àí</button>
                <button id="playerClose" class="player-btn" aria-label="Player schlie√üen" title="Schlie√üen">‚úï</button>
            </div>
        </div>

        <div id="playerContent" class="player-content">
            <!-- Waveform Visualizer -->
            <canvas id="playerWaveform" class="waveform" aria-hidden="true" width="300" height="60"></canvas>

            <!-- Time Display -->
            <div class="time-display">
                <span id="playerCurrentTime" aria-live="polite">0:00</span>
                <div id="playerSeekBar" class="seek-bar" role="slider" aria-label="Track-Position" aria-valuemin="0"
                    aria-valuemax="100" aria-valuenow="0" tabindex="0">
                </div>
                <span id="playerDuration" aria-label="Gesamtdauer">0:00</span>
            </div>

            <!-- Preview Badge -->
            <div id="previewBadge" class="preview-badge" style="display: none;" role="alert">
                üì¢ 40s VORSCHAU ‚Ä¢ Kaufen zum Freischalten
            </div>

            <!-- Controls -->
            <div class="player-controls">
                <button id="playerPlayBtn" class="btn-control" aria-label="Abspielen" title="Abspielen">‚ñ∂Ô∏è</button>
                <button id="playerPauseBtn" class="btn-control" style="display: none;" aria-label="Pausieren"
                    title="Pausieren">‚è∏Ô∏è</button>
                <button id="playerStopBtn" class="btn-control" aria-label="Stoppen" title="Stoppen">‚èπÔ∏è</button>
                <button id="playerLoopBtn" class="btn-control" aria-label="Schleife" title="Schleife">üîÑ</button>
                <button id="playerMuteBtn" class="btn-control" aria-label="Stummschalten"
                    title="Stummschalten">üîä</button>
            </div>

            <!-- Volume Slider -->
            <div class="volume-control">
                <label for="playerVolumeSlider" class="volume-label">Lautst√§rke:</label>
                <input id="playerVolumeSlider" type="range" min="0" max="100" value="80" class="volume-slider"
                    aria-label="Lautst√§rkeregler" aria-valuemin="0" aria-valuemax="100">
            </div>
        </div>

        <!-- ‚úÖ Resize Handle (unten rechts) -->
        <div class="player-resize-handle" id="playerResizeHandle" aria-label="Player vergr√∂√üern/verkleinern"></div>
    </div>

    <!-- ========================================================================
         HEADER
         ======================================================================== -->
    <header role="banner">
        <div class="header-content">
            <div class="logo-section">
                <h1 id="neonSign">‚ô™ SONG-NEXUS</h1>
                <div class="neon-grime" style="
                    position: absolute;
                    top: -10px;
                    left: 0;
                    width: 100%;
                    height: 120%;
                    pointer-events: none;
                    background: radial-gradient(circle at 30% 40%, rgba(0,0,0,0.25), transparent),
                                radial-gradient(circle at 70% 60%, rgba(0,0,0,0.2), transparent),
                                radial-gradient(circle at 20% 80%, rgba(80,40,0,0.15), transparent);
                    filter: blur(8px);
                "></div>
            </div>
            <div class="header-actions">
                <button class="theme-toggle" id="themeToggle" aria-label="Dunkelmodus / Hellmodus umschalten"
                    aria-pressed="true">üåô</button>
                <div id="userInfo" class="user-info" style="display: none;" role="complementary">
                    <span id="userDisplay">üë§ Benutzer</span>
                    <button class="button button-sm" id="logoutBtn" aria-label="Abmelden">Abmelden</button>
                </div>
                <button id="authButton" class="button button-sm" aria-label="Anmeldung √∂ffnen">Anmelden</button>
            </div>
        </div>
    </header>

    <!-- ========================================================================
         MAIN CONTENT
         ======================================================================== -->
    <main class="container" role="main">

        <!-- ====================================================================
             üé¨ HERO SECTION
             ==================================================================== -->
        <section class="hero" aria-labelledby="hero-heading">
            <h2 id="hero-heading">Willkommen bei SONG-NEXUS</h2>
            <p class="hero-subtitle">
                üéµ Musikstreaming ohne Werbung, ohne Cookies, ohne Tracking.<br>
                <strong>Optional anmelden f√ºr pers√∂nliche Funktionen.</strong>
            </p>
        </section>

        <!-- ====================================================================
             üîê OPTIONAL AUTH MODAL
             ==================================================================== -->
        <div id="authModal" class="modal-overlay" style="display: none;" role="dialog"
            aria-labelledby="auth-modal-title" aria-modal="true">
            <div class="modal-content">
                <h2 id="auth-modal-title">üîê Authentifizierung</h2>
                <p style="color: var(--color-text-secondary); font-size: 0.9rem;">
                    Optional: Melden Sie sich an, um Verlauf, Wiedergabelisten und Premium-Funktionen zu nutzen.
                </p>

                <!-- Tabs -->
                <div class="tabs" role="tablist">
                    <button class="tab-btn active" data-tab="webauthn" aria-selected="true" role="tab"
                        aria-controls="webauthn-tab" id="tab-webauthn">üëÜ Fingerabdruck</button>
                    <button class="tab-btn" data-tab="password" aria-selected="false" role="tab"
                        aria-controls="password-tab" id="tab-password">üîë Passwort</button>
                    <button class="tab-btn" data-tab="magic-link" aria-selected="false" role="tab"
                        aria-controls="magic-link-tab" id="tab-magic">üìß E-Mail</button>
                </div>

                <!-- WebAuthn Tab -->
                <div id="webauthn-tab" class="tab-content active" role="tabpanel" aria-labelledby="tab-webauthn">
                    <div style="text-align: center; padding: 20px 0;">
                        <button class="button" id="webauthnBtn" aria-label="Mit Fingerabdruck anmelden">üëÜ Fingerabdruck
                            verwenden</button>
                        <p style="color: var(--color-text-secondary); margin-top: 12px; font-size: 0.85rem;">
                            Erste Anmeldung? <a href="#" id="toggleBioRegisterBtn"
                                style="color: var(--color-primary); cursor: pointer;">Mit Fingerabdruck registrieren</a>
                        </p>
                        <div id="bioRegisterModal"
                            style="display: none; margin-top: 16px; padding: 16px; border: 1px solid var(--color-primary); border-radius: 4px;">
                            <h3 style="color: var(--color-primary); margin-bottom: 12px;">üìù Registrierung</h3>
                            <input type="text" id="bioRegUsername" placeholder="Benutzername" class="form-control"
                                aria-label="Benutzername">
                            <input type="email" id="bioRegEmail" placeholder="E-Mail" class="form-control"
                                aria-label="E-Mail-Adresse">
                            <button class="button" id="registerBiometricBtn"
                                style="width: 100%; margin-top: 12px;">Registrieren</button>
                        </div>
                        <div id="bioStatus" class="status-message" role="alert" aria-live="polite"></div>
                    </div>
                </div>

                <!-- PASSWORD LOGIN/REGISTER TAB -->
                <div id="password-tab" class="tab-content" role="tabpanel" aria-labelledby="tab-password">
                    <!-- LOGIN FORM (Default) -->
                    <div id="passwordLoginForm">
                        <form id="passwordLoginFormElement" data-form="password-login" novalidate>
                            <div class="form-group">
                                <label for="loginEmail">E-Mail oder Benutzername</label>
                                <input type="text" id="loginEmail" placeholder="ihre@email.com oder benutzername"
                                    required class="form-control" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label for="loginPassword">Passwort</label>
                                <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required
                                    class="form-control" aria-required="true">
                            </div>
                            <button type="submit" class="button" style="width: 100%;">üîê Anmelden</button>
                        </form>
                        <p style="color: var(--color-text-secondary); margin-top: 12px; font-size: 0.85rem;">
                            Noch kein Konto? <a href="#" id="togglePasswordRegisterBtn"
                                style="color: var(--color-primary); cursor: pointer;">Jetzt registrieren</a>
                        </p>
                        <div id="passwordStatus" class="status-message" role="alert" aria-live="polite"></div>
                    </div>

                    <!-- REGISTRATION FORM (Hidden by default) -->
                    <div id="passwordRegisterForm" style="display: none;">
                        <form id="passwordRegisterFormElement" novalidate>
                            <div class="form-group">
                                <label for="regUsername">Benutzername</label>
                                <input type="text" id="regUsername" placeholder="dein_name" required
                                    class="form-control" aria-required="true">
                                <small style="color: var(--color-text-secondary);">3-20 Zeichen, alphanumerisch</small>
                            </div>
                            <div class="form-group">
                                <label for="regEmail">E-Mail-Adresse</label>
                                <input type="email" id="regEmail" placeholder="deine@email.com" required
                                    class="form-control" aria-required="true">
                            </div>
                            <div class="form-group">
                                <label for="regPassword">Passwort</label>
                                <input type="password" id="regPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required
                                    class="form-control" aria-required="true">
                                <small style="color: var(--color-text-secondary);">Mindestens 8 Zeichen</small>
                            </div>
                            <div class="form-group">
                                <label for="regPasswordConfirm">Passwort wiederholen</label>
                                <input type="password" id="regPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required
                                    class="form-control" aria-required="true">
                            </div>
                            <button type="submit" class="button"
                                style="width: 100%; background: var(--color-primary);">‚úÖ
                                Registrieren</button>
                            <button type="button" id="cancelPasswordRegisterBtn" class="button"
                                style="width: 100%; margin-top: 8px; background: var(--color-text-secondary);">‚ùå
                                Abbrechen</button>
                        </form>
                        <div id="registerStatus" class="status-message" role="alert" aria-live="polite"></div>
                    </div>
                </div>

                <!-- Magic Link Tab -->
                <div id="magic-link-tab" class="tab-content" role="tabpanel" aria-labelledby="tab-magic">
                    <div class="form-group">
                        <label for="magicEmail">E-Mail-Adresse</label>
                        <input type="email" id="magicEmail" placeholder="ihre@email.com" class="form-control"
                            aria-label="E-Mail-Adresse" aria-required="true">
                    </div>
                    <button class="button" id="magicLinkBtn" style="width: 100%;">üìß Anmeldelink senden</button>
                    <div id="magicStatus" class="status-message" role="alert" aria-live="polite"></div>

                    <!-- Manual Magic Link Verification -->
                    <div
                        style="margin-top: 24px; padding-top: 24px; border-top: 1px solid var(--color-primary); opacity: 0.8;">
                        <p style="color: var(--color-text-secondary); font-size: 0.85rem; margin-bottom: 12px;">
                            üìå Oder gib den Token manuell ein:
                        </p>
                        <div class="form-group">
                            <label for="magicToken">Verifikations-Token</label>
                            <input type="text" id="magicToken" placeholder="Token aus der E-Mail einf√ºgen..."
                                class="form-control" aria-label="Magic Link Token" aria-required="false">
                        </div>
                        <button class="button" id="magicVerifyBtn"
                            style="width: 100%; background: var(--color-primary);">‚úÖ Token
                            verifizieren</button>
                    </div>
                    <div id="magicVerifyStatus" class="status-message" role="alert" aria-live="polite"></div>
                </div>

                <!-- Close Modal Button -->
                <button class="button button-secondary" id="closeAuthModalBtn" style="width: 100%; margin-top: 20px;"
                    aria-label="Authentifizierungsmodal schlie√üen">Schlie√üen</button>
            </div>
        </div>

        <!-- ====================================================================
             üéµ FEATURED TRACKS
             ==================================================================== -->
        <section class="featured-section" aria-labelledby="tracks-heading">
            <h2 id="tracks-heading">üéµ Beliebte Tracks</h2>
            <p class="section-subtitle">Musik, keine Anmeldung erforderlich. 40 Sekunden Vorschau f√ºr
                Premium-Tracks.</p>
            <div id="tracksList" class="track-grid" role="region" aria-label="Beliebte Tracks" aria-live="polite"
                aria-busy="true">
                <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px;">
                    <p style="color: var(--color-text-secondary);">‚è≥ Tracks werden geladen...</p>
                </div>
            </div>
        </section>

        <!-- ====================================================================
             üìù BLOG PREVIEW
             ==================================================================== -->
        <section class="blog-section" aria-labelledby="blog-heading">
            <h2 id="blog-heading">üìù Neueste aus dem Blog</h2>
            <div id="blogList" class="track-grid" role="region" aria-label="Blog-Beitr√§ge" aria-live="polite"
                aria-busy="true">
                <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px;">
                    <p style="color: var(--color-text-secondary);">‚è≥ Blog-Beitr√§ge werden geladen...</p>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <a href="blog/" class="button" aria-label="Alle Blog-Beitr√§ge anzeigen">üìñ Alle Beitr√§ge ‚Üí</a>
            </div>
        </section>

    </main>

    <!-- ========================================================================
         FOOTER
         ======================================================================== -->
    <footer role="contentinfo">
        <div class="footer-content">
            <div class="footer-section">
                <h3>üéµ SONG-NEXUS</h3>
                <p>Kostenlose, werbefreie Musikstreaming ohne Tracking.</p>
            </div>
            <div class="footer-section">
                <h3>Links</h3>
                <ul>
                    <li><a href="/" aria-label="Zur Startseite">Startseite</a></li>
                    <li><a href="blog/" aria-label="Zum Blog">Blog</a></li>
                    <li><a href="/docs/" aria-label="Zur Dokumentation">Dokumentation</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Rechtlich</h3>
                <ul>
                    <li><a href="/LICENSE" aria-label="Lizenzinformationen">Lizenz</a></li>
                    <li><a href="https://github.com/Waschtl904/song-nexus" aria-label="GitHub Repository"
                            rel="noopener noreferrer" target="_blank">GitHub</a></li>
                    <li><a href="/privacy-policy/" aria-label="Datenschutzerkl√§rung">Datenschutz</a></li>
                </ul>
            </div>
        </div>
        <p style="text-align: center; color: var(--color-text-secondary); font-size: 0.75rem; margin-top: 20px;">
            üéµ SONG-NEXUS v8.0 ES6 Modules ‚Ä¢ Gebaut mit ‚ù§Ô∏è ‚Ä¢ ¬© 2025 Sebastian | ‚ôø WCAG 2.2 Barrierefrei |
            <span style="color: var(--color-primary);">üç™ Keine Cookies ‚Ä¢ üìä Kein Tracking</span>
        </p>
    </footer>

    <!-- ========================================================================
         üé® DESIGN-SYSTEM RUNTIME LOADER v3.1 (Relative path + API Proxy)
         ======================================================================== -->
    <script>
        /**
         * DESIGN-SYSTEM RUNTIME LOADER v3.1
         * 
         * ‚úÖ FIXED: Uses relative path /api/design-system (via frontend proxy)
         * 1. Try to load from API via frontend proxy (PostgreSQL - has latest changes)
         * 2. Fallback to webpack-generated _design-tokens.css (build-time defaults)
         * 
         * Benefits:
         * - Works through frontend server proxy (no direct backend calls)
         * - CORS + credentials handled by proxy
         * - Design-Editor changes reflected immediately (API)
         * - If API fails, CSS still works (Webpack fallback)
         */

        async function loadDesignSystemFromAPI() {
            try {
                console.log('üé® Design System Runtime Loader v3.1 starting...');

                // ‚úÖ CRITICAL: Use RELATIVE path (proxied through frontend server)
                const apiUrl = '/api/design-system';
                console.log('üåê Attempting to load from API proxy:', apiUrl);

                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    credentials: 'include',
                    timeout: 5000
                });

                console.log('üìä API Response Status:', response.status);

                if (!response.ok) {
                    console.log(`‚ö†Ô∏è API returned ${response.status}`);
                    console.log('üíæ Using webpack-generated _design-tokens.css instead');
                    return false;
                }

                // ‚úÖ Parse the API response
                const designSystem = await response.json();
                console.log('‚úÖ Design System loaded from API:', designSystem);

                // ‚úÖ Extract nested structures CORRECTLY
                const colors = designSystem.colors || {};
                const typography = designSystem.typography || {};
                const spacing = designSystem.spacing || {};
                const radius = designSystem.radius || {};
                const components = designSystem.components || {};

                console.log('   ‚úÖ Colors:', colors);
                console.log('   ‚úÖ Typography:', typography);
                console.log('   ‚úÖ Spacing:', spacing);
                console.log('   ‚úÖ Radius:', radius);

                // ‚úÖ Generate CSS Variables (matching webpack loader output format)
                let cssVariables = 'html {\n';

                // ‚úÖ COLORS (aus colors-Objekt!)
                cssVariables += '  /* Colors from PostgreSQL API via Proxy */\n';
                if (colors.primary) cssVariables += `  --color-primary: ${colors.primary};\n`;
                if (colors.secondary) cssVariables += `  --color-secondary: ${colors.secondary};\n`;
                if (colors.accent_teal) cssVariables += `  --color-accent-teal: ${colors.accent_teal};\n`;
                if (colors.accent_green) cssVariables += `  --color-accent-green: ${colors.accent_green};\n`;
                if (colors.accent_red) cssVariables += `  --color-accent-red: ${colors.accent_red};\n`;
                if (colors.text_primary) cssVariables += `  --color-text-primary: ${colors.text_primary};\n`;
                if (colors.background) cssVariables += `  --color-background: ${colors.background};\n`;

                // ‚úÖ TYPOGRAPHY (aus typography-Objekt!)
                cssVariables += '  /* Typography from PostgreSQL API via Proxy */\n';
                if (typography.font_family_base) {
                    cssVariables += `  --font-family-base: ${typography.font_family_base};\n`;
                }
                if (typography.font_sizes?.base) {
                    cssVariables += `  --font-size-base: ${typography.font_sizes.base};\n`;
                }
                if (typography.font_weights?.normal) {
                    cssVariables += `  --font-weight-normal: ${typography.font_weights.normal};\n`;
                }
                if (typography.font_weights?.bold) {
                    cssVariables += `  --font-weight-bold: ${typography.font_weights.bold};\n`;
                }

                // ‚úÖ LAYOUT (aus spacing/radius-Objekten!)
                cssVariables += '  /* Layout from PostgreSQL API via Proxy */\n';
                if (spacing['8']) {
                    cssVariables += `  --space-8: ${spacing['8']};\n`;
                }
                if (radius.base) {
                    cssVariables += `  --radius-base: ${radius.base};\n`;
                }

                // ‚úÖ BUTTONS (aus components!)
                cssVariables += '  /* Buttons from PostgreSQL API via Proxy */\n';
                if (components.buttons?.primary?.background) {
                    cssVariables += `  --button-primary-background: ${components.buttons.primary.background};\n`;
                }
                if (components.buttons?.primary?.padding) {
                    cssVariables += `  --button-primary-padding: ${components.buttons.primary.padding};\n`;
                }
                if (components.buttons?.primary?.border_radius) {
                    cssVariables += `  --button-primary-border-radius: ${components.buttons.primary.border_radius};\n`;
                }

                cssVariables += '}\n';

                // ‚úÖ Inject into <style> tag (OVERWRITES webpack defaults)
                const styleElement = document.getElementById('design-system-styles');
                if (styleElement) {
                    styleElement.textContent = cssVariables;
                    console.log('‚úÖ Design System CSS injected from API (via proxy)');
                    console.log('   Primary Color:', colors.primary);
                    console.log('   Secondary Color:', colors.secondary);
                    return true;
                } else {
                    console.error('‚ùå design-system-styles element not found!');
                    return false;
                }

            } catch (err) {
                console.error('‚ùå Design System API Error:', err.message);
                console.log('üíæ Falling back to webpack-generated _design-tokens.css');
                return false;
            }
        }

        // ============================================================================
        // EXECUTE LOADER
        // ============================================================================

        console.log('');
        console.log('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
        console.log('‚ïë  üé® DESIGN-SYSTEM LOADER v3.1 ACTIVE            ‚ïë');
        console.log('‚ïë  Via Frontend Proxy ‚Üí API ‚Üí Webpack CSS Fallback ‚ïë');
        console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');
        console.log('');

        // Load immediately if DOM is ready, otherwise wait
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', async () => {
                const success = await loadDesignSystemFromAPI();
                if (!success) {
                    console.log('üíæ Using webpack-generated CSS from _design-tokens.css');
                }
            });
        } else {
            // DOM already loaded
            loadDesignSystemFromAPI().then(success => {
                if (!success) {
                    console.log('üíæ Using webpack-generated CSS from _design-tokens.css');
                }
            });
        }
    </script>


    <!-- ========================================================================
         ‚úÖ WEBPACK BUNDLE (All modules: Auth, WebAuthn, Player, Tracks, etc.)
         ======================================================================== -->
    <script src="./dist/app.bundle.js"></script>

    <!-- ========================================================================
         üîß CRITICAL FIX: Ensure Auth module is fully initialized
         ======================================================================== -->
    <script>
        console.log('üîß HTML Script: Ensuring Auth system is fully initialized...');

        function ensureAuthInitialized() {
            // Check if Auth module exists (from bundle)
            if (typeof Auth === 'undefined') {
                console.warn('‚ö†Ô∏è Auth module not yet available, retrying in 50ms...');
                setTimeout(ensureAuthInitialized, 50);
                return;
            }

            console.log('‚úÖ Auth module found in window object');

            // Call Auth.init() to attach event listeners
            if (typeof Auth.init === 'function') {
                console.log('üìã Calling Auth.init()...');
                Auth.init();
                console.log('‚úÖ Auth.init() completed');
            } else {
                console.error('‚ùå Auth.init is not a function');
            }

            // Also setup close button for modal
            const closeBtn = document.getElementById('closeAuthModalBtn');
            const authModal = document.getElementById('authModal');
            if (closeBtn && authModal) {
                closeBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    authModal.style.display = 'none';
                    console.log('‚úÖ Modal closed via close button');
                });
            }
        }

        // Trigger initialization after DOM is ready and bundle has loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(ensureAuthInitialized, 1000);
            });
        } else {
            // DOM already loaded
            setTimeout(ensureAuthInitialized, 1000);
        }
    </script>

    <!-- ========================================================================
         ‚úÖ MAGIC LINK HANDLER
         ======================================================================== -->
    <script>
        console.log('üîê Checking current URL for Magic Link:', window.location.pathname);

        if (window.location.pathname === '/auth/magic-link' ||
            window.location.pathname.includes('auth/magic-link')) {

            console.log('üîêüîêüîê MAGIC LINK PAGE DETECTED! üîêüîêüîê');

            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', async () => {
                    console.log('üîê DOM loaded, calling Auth.verifyMagicLinkFromUrl()...');
                    if (typeof Auth !== 'undefined' && Auth.verifyMagicLinkFromUrl) {
                        try {
                            const result = await Auth.verifyMagicLinkFromUrl();
                            console.log('‚úÖ Magic link result:', result);
                        } catch (err) {
                            console.error('‚ùå Magic link verification failed:', err);
                        }
                    } else {
                        console.error('‚ùå Auth module not loaded yet!');
                    }
                });
            } else {
                setTimeout(async () => {
                    console.log('üîê DOM already loaded, calling Auth.verifyMagicLinkFromUrl()...');
                    if (typeof Auth !== 'undefined' && Auth.verifyMagicLinkFromUrl) {
                        try {
                            const result = await Auth.verifyMagicLinkFromUrl();
                            console.log('‚úÖ Magic link result:', result);
                        } catch (err) {
                            console.error('‚ùå Magic link verification failed:', err);
                        }
                    }
                }, 500);
            }
        }
    </script>

</body>

</html>