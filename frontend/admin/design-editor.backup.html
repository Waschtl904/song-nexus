<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Design Editor ‚Äì SONG-NEXUS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1820 100%);
            color: #b0b0b0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 40px;
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
        }

        h1 {
            font-size: 2rem;
            color: #808080;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.8);
            margin-bottom: 5px;
            font-family: 'Courier New', monospace;
            letter-spacing: 3px;
            font-weight: normal;
        }

        .subtitle {
            color: #666;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .editor-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 1024px) {
            .editor-layout {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(15, 15, 18, 0.9);
            border: 1px solid #333;
            border-radius: 2px;
            padding: 30px;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .panel h2 {
            color: #808080;
            margin-bottom: 25px;
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
            font-weight: normal;
        }

        .section {
            margin-bottom: 30px;
            padding-bottom: 25px;
            border-bottom: 1px solid rgba(100, 100, 100, 0.2);
        }

        .section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .section-title {
            color: #666;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            font-weight: normal;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #888;
            font-size: 0.8rem;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        input[type="color"],
        input[type="text"],
        input[type="number"],
        textarea {
            width: 100%;
            padding: 10px;
            background: rgba(20, 20, 25, 0.8);
            border: 1px solid #333;
            border-radius: 2px;
            color: #b0b0b0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            transition: all 200ms ease;
        }

        input[type="color"] {
            cursor: pointer;
            height: 50px;
            padding: 2px;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        textarea:focus {
            outline: none;
            border-color: #555;
            background: rgba(20, 20, 25, 0.95);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
            font-size: 0.85rem;
        }

        .color-value {
            font-size: 0.75rem;
            color: #555;
            margin-top: 4px;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 30px;
        }

        .button-group.full {
            grid-template-columns: 1fr;
        }

        button {
            padding: 12px 20px;
            border: 1px solid #444;
            border-radius: 2px;
            background: rgba(30, 30, 35, 0.8);
            color: #888;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            font-weight: normal;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 200ms ease;
        }

        button:hover {
            background: rgba(40, 40, 45, 0.9);
            border-color: #555;
            color: #a0a0a0;
        }

        button:active {
            transform: scale(0.98);
        }

        .btn-save {
            grid-column: 1 / -1;
            background: rgba(30, 40, 30, 0.8);
            border-color: #444;
            color: #888;
        }

        .btn-save:hover {
            background: rgba(40, 50, 40, 0.9);
            border-color: #555;
            color: #a0a0a0;
        }

        .btn-reset {
            background: rgba(40, 30, 30, 0.8);
            border-color: #444;
            color: #888;
        }

        .btn-reset:hover {
            background: rgba(50, 35, 35, 0.9);
            border-color: #555;
            color: #a0a0a0;
        }

        .btn-master-reset {
            width: 100%;
            background: rgba(30, 25, 25, 0.8);
            border-color: #555;
            color: #777;
            font-size: 0.75rem;
            margin-top: 15px;
        }

        .btn-master-reset:hover {
            background: rgba(40, 30, 30, 0.9);
            border-color: #666;
            color: #999;
        }

        .preview-section {
            min-height: 400px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(15, 15, 20, 0.9), rgba(20, 20, 25, 0.9));
            border-radius: 2px;
            border: 1px solid #333;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .preview-card {
            width: 100%;
            padding: 20px;
            border-radius: 2px;
            margin: 15px 0;
            border: 1px solid #333;
            text-align: center;
        }

        .preview-button {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 2px;
            margin: 10px 5px;
            border: 1px solid;
            font-weight: normal;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }

        .status-message {
            padding: 12px 15px;
            border-radius: 2px;
            margin-top: 15px;
            font-size: 0.9rem;
            border-left: 1px solid;
            display: none;
        }

        .status-message.show {
            display: block;
        }

        .status-success {
            background: rgba(30, 40, 30, 0.2);
            border-left-color: #555;
            color: #888;
        }

        .status-error {
            background: rgba(40, 30, 30, 0.2);
            border-left-color: #666;
            color: #999;
        }

        .status-loading {
            background: rgba(30, 35, 40, 0.2);
            border-left-color: #555;
            color: #888;
        }

        .info-box {
            background: rgba(20, 25, 30, 0.5);
            border: 1px solid #333;
            border-radius: 2px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 0.85rem;
            color: #777;
        }

        .info-box strong {
            color: #888;
        }

        .danger-zone {
            background: rgba(40, 25, 25, 0.3);
            border: 1px solid #444;
            border-radius: 2px;
            padding: 20px;
            margin-top: 30px;
        }

        .danger-zone h3 {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .danger-zone p {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 1px solid #444;
            border-top: 1px solid #888;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>‚ïê‚ïê‚ïê DESIGN EDITOR ‚ïê‚ïê‚ïê</h1>
            <p class="subtitle">Konfiguriere die visuellen Einstellungen des Systems</p>
        </header>

        <div class="editor-layout">
            <div class="panel">
                <h2>‚öô EINSTELLUNGEN</h2>

                <div class="info-box">
                    <strong>‚Üí Hinweis:</strong> √Ñnderungen werden live in der Vorschau angezeigt. Mit "SPEICHERN" in die
                    Datenbank schreiben.
                </div>

                <div class="section">
                    <div class="section-title">‚ñ∫ Farben</div>

                    <div class="form-group">
                        <label for="colorPrimary">Prim√§rfarbe</label>
                        <input type="color" id="colorPrimary" value="#00CC77">
                        <div class="color-value" id="colorPrimaryValue">#00CC77</div>
                    </div>

                    <div class="form-group">
                        <label for="colorSecondary">Sekund√§rfarbe</label>
                        <input type="color" id="colorSecondary" value="#5E5240">
                        <div class="color-value" id="colorSecondaryValue">#5E5240</div>
                    </div>

                    <div class="form-group">
                        <label for="colorAccentTeal">Akzentfarbe (Teal)</label>
                        <input type="color" id="colorAccentTeal" value="#32B8C6">
                        <div class="color-value" id="colorAccentTealValue">#32B8C6</div>
                    </div>

                    <div class="form-group">
                        <label for="colorTextPrimary">Textfarbe</label>
                        <input type="color" id="colorTextPrimary" value="#1A1F2E">
                        <div class="color-value" id="colorTextPrimaryValue">#1A1F2E</div>
                    </div>

                    <div class="form-group">
                        <label for="colorBackground">Hintergrundfarbe</label>
                        <input type="color" id="colorBackground" value="#FCF8F9">
                        <div class="color-value" id="colorBackgroundValue">#FCF8F9</div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">‚ñ∫ Bilder & Assets</div>

                    <div class="form-group">
                        <label for="backgroundImageUrl">Hintergrund-URL</label>
                        <input type="text" id="backgroundImageUrl" placeholder="https://example.com/bg.jpg">
                        <div style="color: #555; font-size: 0.75rem; margin-top: 5px;">WebP oder JPEG empfohlen</div>
                    </div>

                    <div class="form-group">
                        <label for="playerBackgroundImageUrl">Player-Hintergrund URL</label>
                        <input type="text" id="playerBackgroundImageUrl"
                            placeholder="https://example.com/player-bg.jpg">
                    </div>

                    <div class="form-group">
                        <label for="logoUrl">Logo URL</label>
                        <input type="text" id="logoUrl" placeholder="https://example.com/logo.png">
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">‚ñ∫ Typografie</div>

                    <div class="form-group">
                        <label for="fontFamilyBase">Schriftart</label>
                        <input type="text" id="fontFamilyBase" value="Inter, sans-serif"
                            placeholder="z.B. Inter, sans-serif">
                    </div>

                    <div class="form-group">
                        <label for="fontSizeBase">Basis-Schriftgr√∂√üe (px)</label>
                        <input type="number" id="fontSizeBase" value="14" min="10" max="20">
                    </div>
                </div>

                <div class="section">
                    <div class="section-title">‚ñ∫ Layout</div>

                    <div class="form-group">
                        <label for="buttonPadding">Button-Padding</label>
                        <input type="text" id="buttonPadding" value="10px 20px" placeholder="10px 20px">
                    </div>

                    <div class="form-group">
                        <label for="borderRadius">Border-Radius (px)</label>
                        <input type="number" id="borderRadius" value="8" min="0" max="20">
                    </div>

                    <div class="form-group">
                        <label for="spacingUnit">Spacing-Unit (px)</label>
                        <input type="number" id="spacingUnit" value="8" min="4" max="16">
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn-save" id="saveBtn">üíæ SPEICHERN</button>
                    <button class="btn-reset" id="resetBtn">‚Ü∂ ZUR√úCKSETZEN</button>
                </div>

                <div class="danger-zone">
                    <h3>‚ö† MEISTER-ZUR√úCKSETZEN</h3>
                    <p>Setzt alle Design-Einstellungen auf die Standardwerte zur√ºck. Diese Aktion kann nicht r√ºckg√§ngig
                        gemacht werden.</p>
                    <button class="btn-master-reset" id="masterResetBtn">üîÑ ALLE EINSTELLUNGEN ZUR√úCKSETZEN</button>
                </div>

                <div class="status-message" id="statusMessage"></div>
            </div>

            <div class="panel">
                <h2>üëÅ VORSCHAU</h2>
                <div class="preview-section" id="previewContainer">
                    <p style="color: #666;">√Ñnderungen werden hier angezeigt...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://localhost:3000';
        let designSystemId = 1;
        let originalDesignSystem = {};

        const DEFAULT_DESIGN = {
            color_primary: '#00CC77',
            color_secondary: '#5E5240',
            color_accent_teal: '#32B8C6',
            color_text_primary: '#1A1F2E',
            color_background: '#FCF8F9',
            background_image_url: '',
            player_background_image_url: '',
            logo_url: '',
            font_family_base: 'Inter, sans-serif',
            font_size_base: 14,
            button_padding: '10px 20px',
            border_radius: 8,
            spacing_unit: 8
        };

        function showStatus(message, type = 'success') {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message show status-${type}`;

            if (type !== 'loading') {
                setTimeout(() => statusEl.classList.remove('show'), 4000);
            }
        }

        function formatColorValue(hex) {
            return hex.toUpperCase();
        }

        document.getElementById('colorPrimary').addEventListener('input', (e) => {
            document.getElementById('colorPrimaryValue').textContent = formatColorValue(e.target.value);
            updatePreview();
        });

        document.getElementById('colorSecondary').addEventListener('input', (e) => {
            document.getElementById('colorSecondaryValue').textContent = formatColorValue(e.target.value);
            updatePreview();
        });

        document.getElementById('colorAccentTeal').addEventListener('input', (e) => {
            document.getElementById('colorAccentTealValue').textContent = formatColorValue(e.target.value);
            updatePreview();
        });

        document.getElementById('colorTextPrimary').addEventListener('input', (e) => {
            document.getElementById('colorTextPrimaryValue').textContent = formatColorValue(e.target.value);
            updatePreview();
        });

        document.getElementById('colorBackground').addEventListener('input', (e) => {
            document.getElementById('colorBackgroundValue').textContent = formatColorValue(e.target.value);
            updatePreview();
        });

        ['backgroundImageUrl', 'playerBackgroundImageUrl', 'logoUrl', 'fontFamilyBase',
            'fontSizeBase', 'buttonPadding', 'borderRadius', 'spacingUnit'].forEach(id => {
                document.getElementById(id).addEventListener('input', updatePreview);
            });

        function updatePreview() {
            const ds = getFormData();
            const preview = document.getElementById('previewContainer');

            preview.innerHTML = `
                <div class="preview-card" style="
                    background: ${ds.color_background};
                    color: ${ds.color_text_primary};
                    border-color: ${ds.color_primary};
                ">
                    <h3 style="color: ${ds.color_primary}; margin-bottom: 15px;">SONG-NEXUS</h3>
                    
                    <div class="preview-button" style="
                        background: ${ds.color_primary};
                        color: white;
                        border-color: ${ds.color_primary};
                        padding: ${ds.button_padding};
                        border-radius: ${ds.border_radius}px;
                    ">
                        ‚ñ∂ PLAY
                    </div>

                    <div class="preview-button" style="
                        background: transparent;
                        color: ${ds.color_primary};
                        border-color: ${ds.color_accent_teal};
                    ">
                        üíæ SAVE
                    </div>

                    ${ds.background_image_url ? `
                        <div style="
                            margin-top: 15px;
                            border-radius: ${ds.border_radius}px;
                            overflow: hidden;
                            border: 1px solid ${ds.color_primary};
                            max-height: 200px;
                        ">
                            <img src="${ds.background_image_url}" alt="Preview" style="
                                width: 100%;
                                height: 100%;
                                object-fit: cover;
                            ">
                        </div>
                    ` : ''}

                    <div style="
                        margin-top: 15px;
                        padding: 10px;
                        background: rgba(0,0,0,0.1);
                        border-radius: ${ds.border_radius}px;
                        font-size: 0.8rem;
                        color: ${ds.color_text_primary};
                    ">
                        <strong>Font:</strong> ${ds.font_family_base}<br>
                        <strong>Size:</strong> ${ds.font_size_base}px
                    </div>
                </div>
            `;
        }

        function getFormData() {
            return {
                color_primary: document.getElementById('colorPrimary').value,
                color_secondary: document.getElementById('colorSecondary').value,
                color_accent_teal: document.getElementById('colorAccentTeal').value,
                color_text_primary: document.getElementById('colorTextPrimary').value,
                color_background: document.getElementById('colorBackground').value,
                background_image_url: document.getElementById('backgroundImageUrl').value,
                player_background_image_url: document.getElementById('playerBackgroundImageUrl').value,
                logo_url: document.getElementById('logoUrl').value,
                font_family_base: document.getElementById('fontFamilyBase').value,
                font_size_base: parseInt(document.getElementById('fontSizeBase').value),
                button_padding: document.getElementById('buttonPadding').value,
                border_radius: parseInt(document.getElementById('borderRadius').value),
                spacing_unit: parseInt(document.getElementById('spacingUnit').value)
            };
        }

        function setFormData(ds) {
            document.getElementById('colorPrimary').value = ds.color_primary || DEFAULT_DESIGN.color_primary;
            document.getElementById('colorSecondary').value = ds.color_secondary || DEFAULT_DESIGN.color_secondary;
            document.getElementById('colorAccentTeal').value = ds.color_accent_teal || DEFAULT_DESIGN.color_accent_teal;
            document.getElementById('colorTextPrimary').value = ds.color_text_primary || DEFAULT_DESIGN.color_text_primary;
            document.getElementById('colorBackground').value = ds.color_background || DEFAULT_DESIGN.color_background;
            document.getElementById('backgroundImageUrl').value = ds.background_image_url || '';
            document.getElementById('playerBackgroundImageUrl').value = ds.player_background_image_url || '';
            document.getElementById('logoUrl').value = ds.logo_url || '';
            document.getElementById('fontFamilyBase').value = ds.font_family_base || DEFAULT_DESIGN.font_family_base;
            document.getElementById('fontSizeBase').value = ds.font_size_base || DEFAULT_DESIGN.font_size_base;
            document.getElementById('buttonPadding').value = ds.button_padding || DEFAULT_DESIGN.button_padding;
            document.getElementById('borderRadius').value = ds.border_radius || DEFAULT_DESIGN.border_radius;
            document.getElementById('spacingUnit').value = ds.spacing_unit || DEFAULT_DESIGN.spacing_unit;

            document.getElementById('colorPrimaryValue').textContent = formatColorValue(ds.color_primary || DEFAULT_DESIGN.color_primary);
            document.getElementById('colorSecondaryValue').textContent = formatColorValue(ds.color_secondary || DEFAULT_DESIGN.color_secondary);
            document.getElementById('colorAccentTealValue').textContent = formatColorValue(ds.color_accent_teal || DEFAULT_DESIGN.color_accent_teal);
            document.getElementById('colorTextPrimaryValue').textContent = formatColorValue(ds.color_text_primary || DEFAULT_DESIGN.color_text_primary);
            document.getElementById('colorBackgroundValue').textContent = formatColorValue(ds.color_background || DEFAULT_DESIGN.color_background);
        }

        async function loadDesignSystem() {
            try {
                showStatus('‚Üí Lade Design-System...', 'loading');
                const response = await fetch(`${API_BASE}/api/design-system`);

                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }

                const ds = await response.json();
                originalDesignSystem = JSON.parse(JSON.stringify(ds));
                designSystemId = ds.id;

                setFormData(ds);
                updatePreview();
                showStatus('‚úì Design-System geladen', 'success');
            } catch (err) {
                console.error('Error loading design system:', err);
                showStatus('‚úó Fehler beim Laden', 'error');
            }
        }

        document.getElementById('saveBtn').addEventListener('click', async () => {
            try {
                showStatus('‚Üí Speichern...', 'loading');
                const data = getFormData();

                const response = await fetch(`${API_BASE}/api/design-system/${designSystemId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error(`Server Error: ${response.status}`);
                }

                const result = await response.json();
                originalDesignSystem = JSON.parse(JSON.stringify(result));
                showStatus('‚úì Design gespeichert', 'success');

                setTimeout(() => {
                    console.log('‚úì Design-System erfolgreich gespeichert!');
                }, 2000);
            } catch (err) {
                console.error('Error saving design system:', err);
                showStatus(`‚úó Fehler: ${err.message}`, 'error');
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('√Ñnderungen verwerfen und zum letzten gespeicherten Stand zur√ºckkehren?')) {
                setFormData(originalDesignSystem);
                updatePreview();
                showStatus('‚Ü∂ Zur√ºckgesetzt zum letzten Stand', 'success');
            }
        });

        document.getElementById('masterResetBtn').addEventListener('click', async () => {
            if (confirm('‚ö† WARNUNG: Alle Design-Einstellungen auf Standardwerte zur√ºcksetzen?')) {
                try {
                    showStatus('‚Üí Master-Reset l√§uft...', 'loading');

                    const response = await fetch(`${API_BASE}/api/design-system/${designSystemId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(DEFAULT_DESIGN)
                    });

                    if (!response.ok) {
                        throw new Error(`Server Error: ${response.status}`);
                    }

                    const result = await response.json();
                    originalDesignSystem = JSON.parse(JSON.stringify(result));
                    setFormData(DEFAULT_DESIGN);
                    updatePreview();
                    showStatus('‚úì Alle Einstellungen auf Standard zur√ºckgesetzt', 'success');
                } catch (err) {
                    console.error('Error resetting design system:', err);
                    showStatus(`‚úó Fehler: ${err.message}`, 'error');
                }
            }
        });

        document.addEventListener('DOMContentLoaded', loadDesignSystem);
    </script>
</body>

</html>